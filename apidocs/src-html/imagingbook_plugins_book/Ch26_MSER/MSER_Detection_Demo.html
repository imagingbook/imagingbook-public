<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (21) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: module: imagingbook_plugins_book, package: Ch26_MSER, class: MSER_Detection_Demo">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">/*******************************************************************************</span>
<span class="source-line-no">002</span><span id="line-2"> * This software is provided as a supplement to the authors' textbooks on digital</span>
<span class="source-line-no">003</span><span id="line-3"> * image processing published by Springer-Verlag in various languages and editions.</span>
<span class="source-line-no">004</span><span id="line-4"> * Permission to use and distribute this software is granted under the BSD 2-Clause</span>
<span class="source-line-no">005</span><span id="line-5"> * "Simplified" License (see http://opensource.org/licenses/BSD-2-Clause).</span>
<span class="source-line-no">006</span><span id="line-6"> * Copyright (c) 2006-2023 Wilhelm Burger, Mark J. Burge. All rights reserved.</span>
<span class="source-line-no">007</span><span id="line-7"> * Visit https://imagingbook.com for additional details.</span>
<span class="source-line-no">008</span><span id="line-8"> ******************************************************************************/</span>
<span class="source-line-no">009</span><span id="line-9">package Ch26_MSER;</span>
<span class="source-line-no">010</span><span id="line-10"></span>
<span class="source-line-no">011</span><span id="line-11">import ij.IJ;</span>
<span class="source-line-no">012</span><span id="line-12">import ij.ImagePlus;</span>
<span class="source-line-no">013</span><span id="line-13">import ij.gui.GenericDialog;</span>
<span class="source-line-no">014</span><span id="line-14">import ij.gui.Overlay;</span>
<span class="source-line-no">015</span><span id="line-15">import ij.gui.Roi;</span>
<span class="source-line-no">016</span><span id="line-16">import ij.plugin.filter.PlugInFilter;</span>
<span class="source-line-no">017</span><span id="line-17">import ij.process.ByteProcessor;</span>
<span class="source-line-no">018</span><span id="line-18">import ij.process.ColorProcessor;</span>
<span class="source-line-no">019</span><span id="line-19">import ij.process.ImageProcessor;</span>
<span class="source-line-no">020</span><span id="line-20">import imagingbook.common.geometry.basic.Pnt2d;</span>
<span class="source-line-no">021</span><span id="line-21">import imagingbook.common.geometry.ellipse.GeometricEllipse;</span>
<span class="source-line-no">022</span><span id="line-22">import imagingbook.common.ij.DialogUtils;</span>
<span class="source-line-no">023</span><span id="line-23">import imagingbook.common.ij.GuiTools;</span>
<span class="source-line-no">024</span><span id="line-24">import imagingbook.common.ij.overlay.ColoredStroke;</span>
<span class="source-line-no">025</span><span id="line-25">import imagingbook.common.ij.overlay.ShapeOverlayAdapter;</span>
<span class="source-line-no">026</span><span id="line-26">import imagingbook.common.mser.MserColors;</span>
<span class="source-line-no">027</span><span id="line-27">import imagingbook.common.mser.MserData;</span>
<span class="source-line-no">028</span><span id="line-28">import imagingbook.common.mser.MserDetector;</span>
<span class="source-line-no">029</span><span id="line-29">import imagingbook.common.mser.MserParameters;</span>
<span class="source-line-no">030</span><span id="line-30">import imagingbook.common.mser.components.Component;</span>
<span class="source-line-no">031</span><span id="line-31">import imagingbook.common.mser.components.PixelMap.Pixel;</span>
<span class="source-line-no">032</span><span id="line-32">import imagingbook.core.jdoc.JavaDocHelp;</span>
<span class="source-line-no">033</span><span id="line-33">import imagingbook.core.resource.ImageResource;</span>
<span class="source-line-no">034</span><span id="line-34">import imagingbook.sampleimages.GeneralSampleImage;</span>
<span class="source-line-no">035</span><span id="line-35"></span>
<span class="source-line-no">036</span><span id="line-36">import java.awt.Color;</span>
<span class="source-line-no">037</span><span id="line-37">import java.awt.Font;</span>
<span class="source-line-no">038</span><span id="line-38">import java.util.List;</span>
<span class="source-line-no">039</span><span id="line-39"></span>
<span class="source-line-no">040</span><span id="line-40">import static imagingbook.common.ij.DialogUtils.addToDialog;</span>
<span class="source-line-no">041</span><span id="line-41">import static imagingbook.common.ij.DialogUtils.getFromDialog;</span>
<span class="source-line-no">042</span><span id="line-42">import static imagingbook.common.ij.IjUtils.noCurrentImage;</span>
<span class="source-line-no">043</span><span id="line-43"></span>
<span class="source-line-no">044</span><span id="line-44">/**</span>
<span class="source-line-no">045</span><span id="line-45"> * &lt;p&gt;</span>
<span class="source-line-no">046</span><span id="line-46"> * ImageJ plugin which runs MSER detection [1] on the current image and shows the result as a vector overlay in a new</span>
<span class="source-line-no">047</span><span id="line-47"> * image. If the option {@code MarkMserPixels} is selected, the output is a color image with pixels belonging to MSER</span>
<span class="source-line-no">048</span><span id="line-48"> * components marked in different colors. The input image is always converted to grayscale before MSER detection is</span>
<span class="source-line-no">049</span><span id="line-49"> * performed. See Ch. 26 of [2] for details. If no image is currently open, the user is asked to load a predefined</span>
<span class="source-line-no">050</span><span id="line-50"> * sample image.</span>
<span class="source-line-no">051</span><span id="line-51"> * &lt;/p&gt;</span>
<span class="source-line-no">052</span><span id="line-52"> * &lt;p&gt;</span>
<span class="source-line-no">053</span><span id="line-53"> * [1] J. Matas, O. Chum, M. Urban, and T. Pajdla. Robust widebaseline stereo from maximally stable extremal regions.</span>
<span class="source-line-no">054</span><span id="line-54"> * Image and Vision Computing 22(10), 761â€“767 (2004). &lt;br&gt; [2] W. Burger, M.J. Burge, &lt;em&gt;Digital Image Processing</span>
<span class="source-line-no">055</span><span id="line-55"> * &amp;ndash; An Algorithmic Introduction&lt;/em&gt;, 3rd ed, Springer (2022).</span>
<span class="source-line-no">056</span><span id="line-56"> * &lt;/p&gt;</span>
<span class="source-line-no">057</span><span id="line-57"> *</span>
<span class="source-line-no">058</span><span id="line-58"> * @author WB</span>
<span class="source-line-no">059</span><span id="line-59"> * @version 2022/11/24</span>
<span class="source-line-no">060</span><span id="line-60"> * @see MserDetector</span>
<span class="source-line-no">061</span><span id="line-61"> */</span>
<span class="source-line-no">062</span><span id="line-62">public class MSER_Detection_Demo implements PlugInFilter, JavaDocHelp {</span>
<span class="source-line-no">063</span><span id="line-63">        </span>
<span class="source-line-no">064</span><span id="line-64">        private static ImageResource SampleImage = GeneralSampleImage.MortarSmall;</span>
<span class="source-line-no">065</span><span id="line-65">        </span>
<span class="source-line-no">066</span><span id="line-66">        private static boolean ShowMserCount = true;</span>
<span class="source-line-no">067</span><span id="line-67">        private static boolean ShowEllipses = true;</span>
<span class="source-line-no">068</span><span id="line-68">        private static boolean MarkMserPixels = false;</span>
<span class="source-line-no">069</span><span id="line-69">        private static boolean ShowColorPalette = false;</span>
<span class="source-line-no">070</span><span id="line-70">        private static boolean ShowMserLabels = false;</span>
<span class="source-line-no">071</span><span id="line-71">        private static boolean ShowElapsedTime = false;</span>
<span class="source-line-no">072</span><span id="line-72">        </span>
<span class="source-line-no">073</span><span id="line-73">        // processing direction</span>
<span class="source-line-no">074</span><span id="line-74">        private static boolean BlackToWhite = true;             // detect on original image (default)</span>
<span class="source-line-no">075</span><span id="line-75">        private static boolean WhiteToBlack = false;    // detect on inverted image</span>
<span class="source-line-no">076</span><span id="line-76">        </span>
<span class="source-line-no">077</span><span id="line-77">        private static boolean UseTwoColorsOnly = false;        // detect on inverted image</span>
<span class="source-line-no">078</span><span id="line-78">        private static Color BlackToWhiteColor = MserColors.Yellow.getColor();</span>
<span class="source-line-no">079</span><span id="line-79">        private static Color WhiteToBlackColor = MserColors.Cyan.getColor();</span>
<span class="source-line-no">080</span><span id="line-80">        private static int MinDisplayWidth = 300;</span>
<span class="source-line-no">081</span><span id="line-81">        </span>
<span class="source-line-no">082</span><span id="line-82">        private static MserParameters params = new MserParameters();    // MSER parameters</span>
<span class="source-line-no">083</span><span id="line-83">        </span>
<span class="source-line-no">084</span><span id="line-84">        private ImagePlus im = null;</span>
<span class="source-line-no">085</span><span id="line-85">        private Color[] colors = null;</span>
<span class="source-line-no">086</span><span id="line-86">        private double ellipseStrokeWidth = 0;          // set dynamically</span>
<span class="source-line-no">087</span><span id="line-87">        private int labelFontSize = 0;                          // set dynamically</span>
<span class="source-line-no">088</span><span id="line-88">        private Font labelFont = null;                          // set dynamically      </span>
<span class="source-line-no">089</span><span id="line-89">        private Roi roi = null;</span>
<span class="source-line-no">090</span><span id="line-90">        private ByteProcessor bp = null;</span>
<span class="source-line-no">091</span><span id="line-91">        private ImageProcessor ip2 = null;</span>
<span class="source-line-no">092</span><span id="line-92">        private Overlay oly = null;</span>
<span class="source-line-no">093</span><span id="line-93"></span>
<span class="source-line-no">094</span><span id="line-94">        /**</span>
<span class="source-line-no">095</span><span id="line-95">         * Constructor, asks to open a predefined sample image if no other image is currently open.</span>
<span class="source-line-no">096</span><span id="line-96">         */</span>
<span class="source-line-no">097</span><span id="line-97">        public MSER_Detection_Demo() {</span>
<span class="source-line-no">098</span><span id="line-98">                if (noCurrentImage()) {</span>
<span class="source-line-no">099</span><span id="line-99">                        DialogUtils.askForSampleImage(SampleImage);</span>
<span class="source-line-no">100</span><span id="line-100">                }</span>
<span class="source-line-no">101</span><span id="line-101">        }</span>
<span class="source-line-no">102</span><span id="line-102">        </span>
<span class="source-line-no">103</span><span id="line-103">        @Override</span>
<span class="source-line-no">104</span><span id="line-104">        public int setup(String arg0, ImagePlus im) {</span>
<span class="source-line-no">105</span><span id="line-105">                this.im = im;</span>
<span class="source-line-no">106</span><span id="line-106">                return DOES_8G + NO_CHANGES;</span>
<span class="source-line-no">107</span><span id="line-107">        }</span>
<span class="source-line-no">108</span><span id="line-108">        </span>
<span class="source-line-no">109</span><span id="line-109">        @Override</span>
<span class="source-line-no">110</span><span id="line-110">        public void run(ImageProcessor ip) {</span>
<span class="source-line-no">111</span><span id="line-111">                roi = im.getRoi();</span>
<span class="source-line-no">112</span><span id="line-112">                ellipseStrokeWidth = Math.max(0.25, ip.getWidth() * 0.1 / 100);</span>
<span class="source-line-no">113</span><span id="line-113">                labelFontSize = Math.max(3, (int) Math.round(ip.getWidth() / 100.0));   </span>
<span class="source-line-no">114</span><span id="line-114">                                </span>
<span class="source-line-no">115</span><span id="line-115">                if (!runDialog(params)) {</span>
<span class="source-line-no">116</span><span id="line-116">                        return;</span>
<span class="source-line-no">117</span><span id="line-117">                }</span>
<span class="source-line-no">118</span><span id="line-118">                </span>
<span class="source-line-no">119</span><span id="line-119">                bp = ip.convertToByteProcessor();</span>
<span class="source-line-no">120</span><span id="line-120">                ip2 = (MarkMserPixels) ? ip.convertToColorProcessor() : ip.convertToByteProcessor();</span>
<span class="source-line-no">121</span><span id="line-121">                oly = new Overlay();</span>
<span class="source-line-no">122</span><span id="line-122">                String title = im.getShortTitle() + "-MSER";</span>
<span class="source-line-no">123</span><span id="line-123">                </span>
<span class="source-line-no">124</span><span id="line-124">                if (BlackToWhite || WhiteToBlack) title = title + "-";</span>
<span class="source-line-no">125</span><span id="line-125">                if (BlackToWhite)  title = title + "B";</span>
<span class="source-line-no">126</span><span id="line-126">                if (WhiteToBlack)  title = title + "W";</span>
<span class="source-line-no">127</span><span id="line-127">                if (UseTwoColorsOnly) title = title + "-2c";</span>
<span class="source-line-no">128</span><span id="line-128">                </span>
<span class="source-line-no">129</span><span id="line-129">                Color[] palette = MserColors.LevelColors;</span>
<span class="source-line-no">130</span><span id="line-130">                labelFont = new Font(Font.SANS_SERIF, Font.PLAIN, labelFontSize);</span>
<span class="source-line-no">131</span><span id="line-131">        </span>
<span class="source-line-no">132</span><span id="line-132">                List&lt;Component&lt;MserData&gt;&gt; msersB = null;</span>
<span class="source-line-no">133</span><span id="line-133">                List&lt;Component&lt;MserData&gt;&gt; msersW = null;</span>
<span class="source-line-no">134</span><span id="line-134">//              List&lt;Component&lt;MserData&gt;&gt; msersAll = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">135</span><span id="line-135">                </span>
<span class="source-line-no">136</span><span id="line-136">                double elapsedTime = 0;</span>
<span class="source-line-no">137</span><span id="line-137">                </span>
<span class="source-line-no">138</span><span id="line-138">                if (BlackToWhite) {</span>
<span class="source-line-no">139</span><span id="line-139">                        MserDetector detector = new MserDetector(bp, params);</span>
<span class="source-line-no">140</span><span id="line-140">                        msersB = detector.getMserFeatures();</span>
<span class="source-line-no">141</span><span id="line-141">                        if (ShowMserCount) {</span>
<span class="source-line-no">142</span><span id="line-142">                                IJ.log("Found MSERs (BlackToWhite): " + msersB.size());</span>
<span class="source-line-no">143</span><span id="line-143">                        }</span>
<span class="source-line-no">144</span><span id="line-144">                        if (UseTwoColorsOnly) </span>
<span class="source-line-no">145</span><span id="line-145">                                makeColorsBlackToWhite();</span>
<span class="source-line-no">146</span><span id="line-146">                        else</span>
<span class="source-line-no">147</span><span id="line-147">                                makeColors(palette);</span>
<span class="source-line-no">148</span><span id="line-148">                        drawToOverlay(msersB);</span>
<span class="source-line-no">149</span><span id="line-149">                        elapsedTime += detector.getElapsedTime();</span>
<span class="source-line-no">150</span><span id="line-150">                }</span>
<span class="source-line-no">151</span><span id="line-151">                </span>
<span class="source-line-no">152</span><span id="line-152">                if (WhiteToBlack) {</span>
<span class="source-line-no">153</span><span id="line-153">                        bp.invert();</span>
<span class="source-line-no">154</span><span id="line-154">                        MserDetector detector = new MserDetector(bp, params);</span>
<span class="source-line-no">155</span><span id="line-155">                        msersW = detector.getMserFeatures();</span>
<span class="source-line-no">156</span><span id="line-156">                        if (ShowMserCount) {</span>
<span class="source-line-no">157</span><span id="line-157">                                IJ.log("Found MSERs (WhiteToBlack): " + msersW.size());</span>
<span class="source-line-no">158</span><span id="line-158">                        }</span>
<span class="source-line-no">159</span><span id="line-159">                        if (UseTwoColorsOnly) </span>
<span class="source-line-no">160</span><span id="line-160">                                makeColorsWhiteToBlack();</span>
<span class="source-line-no">161</span><span id="line-161">                        else</span>
<span class="source-line-no">162</span><span id="line-162">                                makeColors(palette);</span>
<span class="source-line-no">163</span><span id="line-163">                        drawToOverlay(msersW);</span>
<span class="source-line-no">164</span><span id="line-164">                        elapsedTime += detector.getElapsedTime();</span>
<span class="source-line-no">165</span><span id="line-165">                }</span>
<span class="source-line-no">166</span><span id="line-166">                </span>
<span class="source-line-no">167</span><span id="line-167">                if (ShowMserCount &amp;&amp; BlackToWhite &amp;&amp; WhiteToBlack) {</span>
<span class="source-line-no">168</span><span id="line-168">                        IJ.log("Found MSERs total: " + (msersB.size() + msersW.size()));</span>
<span class="source-line-no">169</span><span id="line-169">                }</span>
<span class="source-line-no">170</span><span id="line-170">                </span>
<span class="source-line-no">171</span><span id="line-171">                if (ShowElapsedTime) {</span>
<span class="source-line-no">172</span><span id="line-172">                        IJ.log(String.format("Algorithm %s: time elapsed %.0fms", params.method, elapsedTime));</span>
<span class="source-line-no">173</span><span id="line-173">                }</span>
<span class="source-line-no">174</span><span id="line-174">                </span>
<span class="source-line-no">175</span><span id="line-175">                if (ShowColorPalette) {</span>
<span class="source-line-no">176</span><span id="line-176">                        if (UseTwoColorsOnly) </span>
<span class="source-line-no">177</span><span id="line-177">                                showTwoColors();</span>
<span class="source-line-no">178</span><span id="line-178">                        else</span>
<span class="source-line-no">179</span><span id="line-179">                                showColorPalette(title + "-palette");</span>
<span class="source-line-no">180</span><span id="line-180">                }</span>
<span class="source-line-no">181</span><span id="line-181">                </span>
<span class="source-line-no">182</span><span id="line-182">                // ----------------------------------------------------------------------</span>
<span class="source-line-no">183</span><span id="line-183">                </span>
<span class="source-line-no">184</span><span id="line-184">//              Component.sortBySize(msersAll); // optional</span>
<span class="source-line-no">185</span><span id="line-185">//              drawToOverlay(msersAll);</span>
<span class="source-line-no">186</span><span id="line-186">                </span>
<span class="source-line-no">187</span><span id="line-187">                ImagePlus cimp = new ImagePlus(title, ip2);</span>
<span class="source-line-no">188</span><span id="line-188">                setMserImageProps(cimp, params);</span>
<span class="source-line-no">189</span><span id="line-189">                cimp.setOverlay(oly);</span>
<span class="source-line-no">190</span><span id="line-190">                cimp.show();</span>
<span class="source-line-no">191</span><span id="line-191">                </span>
<span class="source-line-no">192</span><span id="line-192">                // zoom result image if too small</span>
<span class="source-line-no">193</span><span id="line-193">                if (cimp.getWidth() &lt; MinDisplayWidth) {</span>
<span class="source-line-no">194</span><span id="line-194">                        int zoomFac = (int) Math.ceil((double) MinDisplayWidth / cimp.getWidth());</span>
<span class="source-line-no">195</span><span id="line-195">                        GuiTools.zoomExact(cimp, zoomFac);</span>
<span class="source-line-no">196</span><span id="line-196">                }       </span>
<span class="source-line-no">197</span><span id="line-197">        }</span>
<span class="source-line-no">198</span><span id="line-198">         </span>
<span class="source-line-no">199</span><span id="line-199">        private void drawToOverlay(List&lt;Component&lt;MserData&gt;&gt; msers) {</span>
<span class="source-line-no">200</span><span id="line-200">                ShapeOverlayAdapter ola = new ShapeOverlayAdapter(oly);</span>
<span class="source-line-no">201</span><span id="line-201">                ola.setFont(labelFont);</span>
<span class="source-line-no">202</span><span id="line-202">                </span>
<span class="source-line-no">203</span><span id="line-203">                for (Component&lt;MserData&gt; c : msers) {</span>
<span class="source-line-no">204</span><span id="line-204">                        </span>
<span class="source-line-no">205</span><span id="line-205">                        // ignore MSERs outside the current ROI (if specified)</span>
<span class="source-line-no">206</span><span id="line-206">                        Pnt2d ctr = c.getProperties().getCenter();</span>
<span class="source-line-no">207</span><span id="line-207">                        if (roi != null &amp;&amp; !roi.containsPoint(ctr.getX(), ctr.getY())) {</span>
<span class="source-line-no">208</span><span id="line-208">                                continue;</span>
<span class="source-line-no">209</span><span id="line-209">                        }</span>
<span class="source-line-no">210</span><span id="line-210">                        </span>
<span class="source-line-no">211</span><span id="line-211">                        Color vecCol = getColor(c.getLevel());</span>
<span class="source-line-no">212</span><span id="line-212">                        </span>
<span class="source-line-no">213</span><span id="line-213">                        // draw contained points</span>
<span class="source-line-no">214</span><span id="line-214">                        if (MarkMserPixels) {</span>
<span class="source-line-no">215</span><span id="line-215">                                float[] hsb = Color.RGBtoHSB(vecCol.getRed(), vecCol.getGreen(), vecCol.getBlue(), null);</span>
<span class="source-line-no">216</span><span id="line-216">                                Color pixCol = Color.getHSBColor(hsb[0], 0.5f, 0.5f);</span>
<span class="source-line-no">217</span><span id="line-217">                                ip2.setColor(pixCol);</span>
<span class="source-line-no">218</span><span id="line-218">                                for (Pixel pnt : c.getAllPixels()) {</span>
<span class="source-line-no">219</span><span id="line-219">                                        ip2.drawDot(pnt.x, pnt.y);</span>
<span class="source-line-no">220</span><span id="line-220">                                }</span>
<span class="source-line-no">221</span><span id="line-221">                        }</span>
<span class="source-line-no">222</span><span id="line-222">                        </span>
<span class="source-line-no">223</span><span id="line-223">                        if (ShowEllipses) {</span>
<span class="source-line-no">224</span><span id="line-224">                                // suggests 0.2% of image width as stroke width (but at least 0.5)                      </span>
<span class="source-line-no">225</span><span id="line-225">                                GeometricEllipse ellipse = c.getProperties().getEllipse();</span>
<span class="source-line-no">226</span><span id="line-226">                                ola.addShape(ellipse.getShape(), new ColoredStroke(ellipseStrokeWidth, vecCol));</span>
<span class="source-line-no">227</span><span id="line-227">                                </span>
<span class="source-line-no">228</span><span id="line-228">                                if (ShowMserLabels) {</span>
<span class="source-line-no">229</span><span id="line-229">                                        ola.setTextColor(vecCol);</span>
<span class="source-line-no">230</span><span id="line-230">                                        ola.addText(ellipse.xc, ellipse.yc, Integer.toString(c.ID));</span>
<span class="source-line-no">231</span><span id="line-231">                                }</span>
<span class="source-line-no">232</span><span id="line-232">                        }</span>
<span class="source-line-no">233</span><span id="line-233">                }</span>
<span class="source-line-no">234</span><span id="line-234">        }</span>
<span class="source-line-no">235</span><span id="line-235">        </span>
<span class="source-line-no">236</span><span id="line-236">        // --------------------------------------------</span>
<span class="source-line-no">237</span><span id="line-237">        </span>
<span class="source-line-no">238</span><span id="line-238">        private boolean runDialog(MserParameters params) {</span>
<span class="source-line-no">239</span><span id="line-239">                GenericDialog gd = new GenericDialog(this.getClass().getSimpleName());</span>
<span class="source-line-no">240</span><span id="line-240">                gd.addHelp(getJavaDocUrl());</span>
<span class="source-line-no">241</span><span id="line-241">                addToDialog(params, gd);</span>
<span class="source-line-no">242</span><span id="line-242">                gd.addCheckbox("BLACK -&gt; WHITE", BlackToWhite);</span>
<span class="source-line-no">243</span><span id="line-243">                gd.addCheckbox("WHITE -&gt; BLACK", WhiteToBlack);</span>
<span class="source-line-no">244</span><span id="line-244">                gd.addCheckbox("Use 2 colors only", UseTwoColorsOnly);</span>
<span class="source-line-no">245</span><span id="line-245">                </span>
<span class="source-line-no">246</span><span id="line-246">                gd.addMessage("Output parameters:");</span>
<span class="source-line-no">247</span><span id="line-247">                gd.addCheckbox("Show MSER count", ShowMserCount);</span>
<span class="source-line-no">248</span><span id="line-248">                gd.addCheckbox("Show elapsed time", ShowElapsedTime);</span>
<span class="source-line-no">249</span><span id="line-249">                gd.addCheckbox("Show ellipses", ShowEllipses);</span>
<span class="source-line-no">250</span><span id="line-250">                gd.addNumericField("Ellipse stroke width", ellipseStrokeWidth, 2);</span>
<span class="source-line-no">251</span><span id="line-251">                gd.addCheckbox("Show MSER labels", ShowMserLabels);</span>
<span class="source-line-no">252</span><span id="line-252">                gd.addNumericField("Label font size", labelFontSize, 0);</span>
<span class="source-line-no">253</span><span id="line-253">                gd.addCheckbox("Mark MSER pixels", MarkMserPixels);</span>
<span class="source-line-no">254</span><span id="line-254">                gd.addCheckbox("Show color palette", ShowColorPalette);</span>
<span class="source-line-no">255</span><span id="line-255">                </span>
<span class="source-line-no">256</span><span id="line-256">                gd.showDialog();</span>
<span class="source-line-no">257</span><span id="line-257">                if (gd.wasCanceled())</span>
<span class="source-line-no">258</span><span id="line-258">                        return false;</span>
<span class="source-line-no">259</span><span id="line-259"></span>
<span class="source-line-no">260</span><span id="line-260">                getFromDialog(params, gd);</span>
<span class="source-line-no">261</span><span id="line-261">                </span>
<span class="source-line-no">262</span><span id="line-262">                BlackToWhite = gd.getNextBoolean();</span>
<span class="source-line-no">263</span><span id="line-263">                WhiteToBlack = gd.getNextBoolean();</span>
<span class="source-line-no">264</span><span id="line-264">                UseTwoColorsOnly = gd.getNextBoolean(); </span>
<span class="source-line-no">265</span><span id="line-265">                // Output:</span>
<span class="source-line-no">266</span><span id="line-266">                ShowMserCount = gd.getNextBoolean();</span>
<span class="source-line-no">267</span><span id="line-267">                ShowElapsedTime = gd.getNextBoolean();</span>
<span class="source-line-no">268</span><span id="line-268">                ShowEllipses = gd.getNextBoolean();</span>
<span class="source-line-no">269</span><span id="line-269">                ellipseStrokeWidth = gd.getNextNumber();</span>
<span class="source-line-no">270</span><span id="line-270">                ShowMserLabels = gd.getNextBoolean();</span>
<span class="source-line-no">271</span><span id="line-271">                labelFontSize = (int) gd.getNextNumber();</span>
<span class="source-line-no">272</span><span id="line-272">                MarkMserPixels = gd.getNextBoolean();</span>
<span class="source-line-no">273</span><span id="line-273">                ShowColorPalette = gd.getNextBoolean();</span>
<span class="source-line-no">274</span><span id="line-274">                                </span>
<span class="source-line-no">275</span><span id="line-275">//              // Debugging:</span>
<span class="source-line-no">276</span><span id="line-276">//              params.validateComponentTree = gd.getNextBoolean();</span>
<span class="source-line-no">277</span><span id="line-277">                                </span>
<span class="source-line-no">278</span><span id="line-278">                return true;</span>
<span class="source-line-no">279</span><span id="line-279">        }</span>
<span class="source-line-no">280</span><span id="line-280">        </span>
<span class="source-line-no">281</span><span id="line-281">        // --------------------------------------------</span>
<span class="source-line-no">282</span><span id="line-282">        </span>
<span class="source-line-no">283</span><span id="line-283">        private void makeColors(Color[] palette) {</span>
<span class="source-line-no">284</span><span id="line-284">                final int n = palette.length;</span>
<span class="source-line-no">285</span><span id="line-285">                colors = new Color[256];</span>
<span class="source-line-no">286</span><span id="line-286">                for (int level = 0; level &lt; 256; level++) {</span>
<span class="source-line-no">287</span><span id="line-287">                        int k = (int) (n * level / 256.0);              // k in [0,n-1]</span>
<span class="source-line-no">288</span><span id="line-288">                        colors[level] = palette[k];</span>
<span class="source-line-no">289</span><span id="line-289">                }</span>
<span class="source-line-no">290</span><span id="line-290">        }</span>
<span class="source-line-no">291</span><span id="line-291">        </span>
<span class="source-line-no">292</span><span id="line-292">        private void makeColorsBlackToWhite() {</span>
<span class="source-line-no">293</span><span id="line-293">                colors = new Color[256];</span>
<span class="source-line-no">294</span><span id="line-294">                for (int level = 0; level &lt; 256; level++) {</span>
<span class="source-line-no">295</span><span id="line-295">                        colors[level] = BlackToWhiteColor;</span>
<span class="source-line-no">296</span><span id="line-296">                }</span>
<span class="source-line-no">297</span><span id="line-297">        }</span>
<span class="source-line-no">298</span><span id="line-298">        </span>
<span class="source-line-no">299</span><span id="line-299">        private void makeColorsWhiteToBlack() {</span>
<span class="source-line-no">300</span><span id="line-300">                colors = new Color[256];</span>
<span class="source-line-no">301</span><span id="line-301">                for (int level = 0; level &lt; 256; level++) {</span>
<span class="source-line-no">302</span><span id="line-302">                        colors[level] = WhiteToBlackColor;</span>
<span class="source-line-no">303</span><span id="line-303">                }</span>
<span class="source-line-no">304</span><span id="line-304">        }</span>
<span class="source-line-no">305</span><span id="line-305">        </span>
<span class="source-line-no">306</span><span id="line-306">        private Color getColor(int level) {</span>
<span class="source-line-no">307</span><span id="line-307">                // level is in 0,..,255</span>
<span class="source-line-no">308</span><span id="line-308">                if (level &lt; 0) </span>
<span class="source-line-no">309</span><span id="line-309">                        level = 0;</span>
<span class="source-line-no">310</span><span id="line-310">                if (level &gt;= colors.length)</span>
<span class="source-line-no">311</span><span id="line-311">                        level = colors.length - 1;</span>
<span class="source-line-no">312</span><span id="line-312">                return colors[level];</span>
<span class="source-line-no">313</span><span id="line-313">        }</span>
<span class="source-line-no">314</span><span id="line-314">        </span>
<span class="source-line-no">315</span><span id="line-315">        private void showColorPalette(String title) {</span>
<span class="source-line-no">316</span><span id="line-316">                int W = 20;</span>
<span class="source-line-no">317</span><span id="line-317">                int H = 256;</span>
<span class="source-line-no">318</span><span id="line-318">                ColorProcessor cp = new ColorProcessor(W, H);</span>
<span class="source-line-no">319</span><span id="line-319">                for (int level = 0; level &lt; H; level++) {</span>
<span class="source-line-no">320</span><span id="line-320">                        cp.setColor(getColor(level));</span>
<span class="source-line-no">321</span><span id="line-321">                        for (int i = 0; i &lt; W; i++) {</span>
<span class="source-line-no">322</span><span id="line-322">                                cp.drawPixel(i, level);</span>
<span class="source-line-no">323</span><span id="line-323">                        }</span>
<span class="source-line-no">324</span><span id="line-324">                }</span>
<span class="source-line-no">325</span><span id="line-325">                cp.flipVertical();</span>
<span class="source-line-no">326</span><span id="line-326">                new ImagePlus(title, cp).show();</span>
<span class="source-line-no">327</span><span id="line-327">        }</span>
<span class="source-line-no">328</span><span id="line-328">        </span>
<span class="source-line-no">329</span><span id="line-329">        private void showTwoColors() {</span>
<span class="source-line-no">330</span><span id="line-330">                {</span>
<span class="source-line-no">331</span><span id="line-331">                        ColorProcessor cp = new ColorProcessor(20, 64);</span>
<span class="source-line-no">332</span><span id="line-332">                        cp.setColor(BlackToWhiteColor);</span>
<span class="source-line-no">333</span><span id="line-333">                        cp.fill();</span>
<span class="source-line-no">334</span><span id="line-334">                        new ImagePlus("color-BW", cp).show();</span>
<span class="source-line-no">335</span><span id="line-335">                }</span>
<span class="source-line-no">336</span><span id="line-336">                {</span>
<span class="source-line-no">337</span><span id="line-337">                        ColorProcessor cp = new ColorProcessor(20, 64);</span>
<span class="source-line-no">338</span><span id="line-338">                        cp.setColor(WhiteToBlackColor);</span>
<span class="source-line-no">339</span><span id="line-339">                        cp.fill();</span>
<span class="source-line-no">340</span><span id="line-340">                        new ImagePlus("color-WB", cp).show();</span>
<span class="source-line-no">341</span><span id="line-341">                }</span>
<span class="source-line-no">342</span><span id="line-342">        }</span>
<span class="source-line-no">343</span><span id="line-343"></span>
<span class="source-line-no">344</span><span id="line-344">        // --------------------------------------------</span>
<span class="source-line-no">345</span><span id="line-345">        </span>
<span class="source-line-no">346</span><span id="line-346">        private void setMserImageProps(ImagePlus imp, MserParameters params) {</span>
<span class="source-line-no">347</span><span id="line-347">                imp.setProp("MSER-delta", params.delta);</span>
<span class="source-line-no">348</span><span id="line-348">                imp.setProp("MSER-maxVariation", params.maxSizeVariation);</span>
<span class="source-line-no">349</span><span id="line-349">                imp.setProp("MSER-minDiversity", params.minDiversity);</span>
<span class="source-line-no">350</span><span id="line-350">                imp.setProp("MSER-maxRelArea", params.maxRelCompSize);</span>
<span class="source-line-no">351</span><span id="line-351">                imp.setProp("MSER-minRelArea", params.minRelCompSize);</span>
<span class="source-line-no">352</span><span id="line-352">                imp.setProp("MSER-minAbsArea", params.minAbsComponentArea);</span>
<span class="source-line-no">353</span><span id="line-353">                imp.setProp("MSER-method", params.method.toString());   </span>
<span class="source-line-no">354</span><span id="line-354">        }</span>
<span class="source-line-no">355</span><span id="line-355">        </span>
<span class="source-line-no">356</span><span id="line-356">}</span>




























































</pre>
</div>
</main>
</body>
</html>
