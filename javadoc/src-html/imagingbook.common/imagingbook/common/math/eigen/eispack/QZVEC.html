<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: module: imagingbook.common, package: imagingbook.common.math.eigen.eispack, class: QZVEC">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">/*******************************************************************************</span>
<span class="source-line-no">002</span><span id="line-2"> * This software is provided as a supplement to the authors' textbooks on digital</span>
<span class="source-line-no">003</span><span id="line-3"> * image processing published by Springer-Verlag in various languages and editions.</span>
<span class="source-line-no">004</span><span id="line-4"> * Permission to use and distribute this software is granted under the BSD 2-Clause</span>
<span class="source-line-no">005</span><span id="line-5"> * "Simplified" License (see http://opensource.org/licenses/BSD-2-Clause).</span>
<span class="source-line-no">006</span><span id="line-6"> * Copyright (c) 2006-2023 Wilhelm Burger, Mark J. Burge. All rights reserved.</span>
<span class="source-line-no">007</span><span id="line-7"> * Visit https://imagingbook.com for additional details.</span>
<span class="source-line-no">008</span><span id="line-8"> ******************************************************************************/</span>
<span class="source-line-no">009</span><span id="line-9">package imagingbook.common.math.eigen.eispack;</span>
<span class="source-line-no">010</span><span id="line-10"></span>
<span class="source-line-no">011</span><span id="line-11">public abstract class QZVEC {</span>
<span class="source-line-no">012</span><span id="line-12"></span>
<span class="source-line-no">013</span><span id="line-13">        /*</span>
<span class="source-line-no">014</span><span id="line-14">        EISPACK Routines, see http://www.netlib.org/eispack/ for the original FORTRAN code.</span>
<span class="source-line-no">015</span><span id="line-15">        Untangled to goto-free Java by W. Burger using a sequential state machine concept, inspired by D. E. Knuth,</span>
<span class="source-line-no">016</span><span id="line-16">        "Structured Programming with Goto Statements", Computing Surveys, Vol. 6, No. 4 (1974).</span>
<span class="source-line-no">017</span><span id="line-17">         */</span>
<span class="source-line-no">018</span><span id="line-18"></span>
<span class="source-line-no">019</span><span id="line-19">        private QZVEC() {}</span>
<span class="source-line-no">020</span><span id="line-20">        </span>
<span class="source-line-no">021</span><span id="line-21">        public static boolean VERBOSE = false;</span>
<span class="source-line-no">022</span><span id="line-22"></span>
<span class="source-line-no">023</span><span id="line-23">        /**</span>
<span class="source-line-no">024</span><span id="line-24">         * &lt;p&gt;</span>
<span class="source-line-no">025</span><span id="line-25">         * This subroutine is the optional fourth step of the qz algorithm for solving generalized matrix eigenvalue</span>
<span class="source-line-no">026</span><span id="line-26">         * problems, Siam J. Numer. Anal. 10, 241-256 (1973) by Moler and Stewart. This description has been adapted from</span>
<span class="source-line-no">027</span><span id="line-27">         * the original version (dated August 1983).</span>
<span class="source-line-no">028</span><span id="line-28">         * &lt;/p&gt;</span>
<span class="source-line-no">029</span><span id="line-29">         * &lt;p&gt;</span>
<span class="source-line-no">030</span><span id="line-30">         * This subroutine accepts a pair of real matrices, one of them in quasi-triangular form (in which each 2-by-2 block</span>
<span class="source-line-no">031</span><span id="line-31">         * corresponds to a pair of complex eigenvalues) and the other in upper triangular form. It computes the</span>
<span class="source-line-no">032</span><span id="line-32">         * eigenvectors of the triangular problem and transforms the results back to the original coordinate system. It is</span>
<span class="source-line-no">033</span><span id="line-33">         * usually preceded by qzhes, qzit, and qzval.</span>
<span class="source-line-no">034</span><span id="line-34">         * &lt;/p&gt;</span>
<span class="source-line-no">035</span><span id="line-35">         * &lt;p&gt;</span>
<span class="source-line-no">036</span><span id="line-36">         * On output:</span>
<span class="source-line-no">037</span><span id="line-37">         * &lt;/p&gt;</span>
<span class="source-line-no">038</span><span id="line-38">         * &lt;ul&gt;</span>
<span class="source-line-no">039</span><span id="line-39">         * &lt;li&gt;&lt;strong&gt;a&lt;/strong&gt; is unaltered. Its subdiagonal elements provide  information about the storage of the</span>
<span class="source-line-no">040</span><span id="line-40">         * complex eigenvectors.&lt;/li&gt;</span>
<span class="source-line-no">041</span><span id="line-41">         * &lt;li&gt;&lt;strong&gt;b&lt;/strong&gt; has been destroyed.&lt;/li&gt;</span>
<span class="source-line-no">042</span><span id="line-42">         * &lt;li&gt;&lt;strong&gt;alfr&lt;/strong&gt;, &lt;strong&gt;alfi&lt;/strong&gt; and &lt;strong&gt;beta&lt;/strong&gt; are unaltered.&lt;/li&gt;</span>
<span class="source-line-no">043</span><span id="line-43">         * &lt;li&gt;&lt;strong&gt;z&lt;/strong&gt; contains the real and imaginary parts of the eigenvectors. If alfi(i) = 0.0, the i-th</span>
<span class="source-line-no">044</span><span id="line-44">         * eigenvalue is real and the i-th column of z contains its eigenvector. if alfi(i) &amp;ne; 0.0, the i-th eigenvalue</span>
<span class="source-line-no">045</span><span id="line-45">         * is complex. if alfi(i) &amp;gt; 0.0, the eigenvalue is the first of a complex pair and the i-th and (i+1)-th columns</span>
<span class="source-line-no">046</span><span id="line-46">         * of z contain its eigenvector. If alfi(i) &amp;lt; 0.0, the eigenvalue is the second of a complex pair and the</span>
<span class="source-line-no">047</span><span id="line-47">         * (i-1)-th and i-th columns of z contain the conjugate of its eigenvector. Each eigenvector is normalized so that</span>
<span class="source-line-no">048</span><span id="line-48">         * the modulus of its largest component is 1.0.&lt;/li&gt;</span>
<span class="source-line-no">049</span><span id="line-49">         * &lt;/ul&gt;</span>
<span class="source-line-no">050</span><span id="line-50">         *</span>
<span class="source-line-no">051</span><span id="line-51">         * @param a contains a real upper quasi-triangular matrix.</span>
<span class="source-line-no">052</span><span id="line-52">         * @param b contains a real upper triangular matrix. In addition, location b[n-1][0] contains the tolerance quantity</span>
<span class="source-line-no">053</span><span id="line-53">         * (epsb) computed and saved in qzit.</span>
<span class="source-line-no">054</span><span id="line-54">         * @param alfr , &lt;strong&gt;alfi&lt;/strong&gt;, and &lt;strong&gt;beta&lt;/strong&gt; are vectors with components whose ratios ((alfr +</span>
<span class="source-line-no">055</span><span id="line-55">         * i * alfi) / beta) are the generalized eigenvalues. They are usually obtained from qzval.</span>
<span class="source-line-no">056</span><span id="line-56">         * @param alfi see &lt;strong&gt;alfr&lt;/strong&gt;</span>
<span class="source-line-no">057</span><span id="line-57">         * @param beta see &lt;strong&gt;alfr&lt;/strong&gt;</span>
<span class="source-line-no">058</span><span id="line-58">         * @param z contains the transformation matrix produced in the reductions by qzhes, qzit, and qzval, if performed.</span>
<span class="source-line-no">059</span><span id="line-59">         * If the eigenvectors of the triangular problem are desired, z must contain the identity matrix.</span>
<span class="source-line-no">060</span><span id="line-60">         */</span>
<span class="source-line-no">061</span><span id="line-61">        public static void qzvec(double[][] a, double[][] b, double[] alfr, double[] alfi, double[] beta, double[][] z) {</span>
<span class="source-line-no">062</span><span id="line-62"></span>
<span class="source-line-no">063</span><span id="line-63">                final int n = a.length;</span>
<span class="source-line-no">064</span><span id="line-64"></span>
<span class="source-line-no">065</span><span id="line-65">                int i = 0, j, k, m;</span>
<span class="source-line-no">066</span><span id="line-66">                int na = 0, ii, en = 0, jj, nn, enm2;</span>
<span class="source-line-no">067</span><span id="line-67">                double d = 0, q;</span>
<span class="source-line-no">068</span><span id="line-68">                double r = 0, s = 0, t = 0, w = 0, x = 0, y = 0, t1 = 0, t2 = 0, w1 = 0, x1 = 0, z1 = 0, di = 0;</span>
<span class="source-line-no">069</span><span id="line-69">                double ra = 0, dr = 0, sa = 0;</span>
<span class="source-line-no">070</span><span id="line-70">                double ti = 0, rr, tr = 0, zz = 0;</span>
<span class="source-line-no">071</span><span id="line-71">                double alfm, almi, betm, almr;</span>
<span class="source-line-no">072</span><span id="line-72"></span>
<span class="source-line-no">073</span><span id="line-73">                double epsb = b[n - 1][0];</span>
<span class="source-line-no">074</span><span id="line-74">                int isw = 1;</span>
<span class="source-line-no">075</span><span id="line-75"></span>
<span class="source-line-no">076</span><span id="line-76">                if (VERBOSE) System.out.println("QZVEC: starting Loop A ***********************");</span>
<span class="source-line-no">077</span><span id="line-77">                LoopA: for (nn = 0; nn &lt; n; nn++) {</span>
<span class="source-line-no">078</span><span id="line-78"></span>
<span class="source-line-no">079</span><span id="line-79">                        StateA stateA = StateA.Ainit;</span>
<span class="source-line-no">080</span><span id="line-80">                        StateLoopA: while (stateA != StateA.Afinal) {</span>
<span class="source-line-no">081</span><span id="line-81"></span>
<span class="source-line-no">082</span><span id="line-82">                                switch(stateA) {</span>
<span class="source-line-no">083</span><span id="line-83">                                case Ainit :</span>
<span class="source-line-no">084</span><span id="line-84">                                        en = n - 1 - nn;        // TODO: check!!</span>
<span class="source-line-no">085</span><span id="line-85">                                        na = en - 1;</span>
<span class="source-line-no">086</span><span id="line-86">                                        if (isw == 2) {</span>
<span class="source-line-no">087</span><span id="line-87">                                                stateA = StateA.A795;</span>
<span class="source-line-no">088</span><span id="line-88">                                                break;</span>
<span class="source-line-no">089</span><span id="line-89">                                        }</span>
<span class="source-line-no">090</span><span id="line-90">                                        if (alfi[en] != 0.0) {</span>
<span class="source-line-no">091</span><span id="line-91">                                                stateA = StateA.A710;</span>
<span class="source-line-no">092</span><span id="line-92">                                                break;</span>
<span class="source-line-no">093</span><span id="line-93">                                        }</span>
<span class="source-line-no">094</span><span id="line-94"></span>
<span class="source-line-no">095</span><span id="line-95">                                        // Real vector</span>
<span class="source-line-no">096</span><span id="line-96">                                        m = en;</span>
<span class="source-line-no">097</span><span id="line-97">                                        b[en][en] = 1.0;</span>
<span class="source-line-no">098</span><span id="line-98">                                        if (na == -1) {</span>
<span class="source-line-no">099</span><span id="line-99">                                                stateA = StateA.A800;</span>
<span class="source-line-no">100</span><span id="line-100">                                                break;</span>
<span class="source-line-no">101</span><span id="line-101">                                        }</span>
<span class="source-line-no">102</span><span id="line-102">                                        alfm = alfr[m];</span>
<span class="source-line-no">103</span><span id="line-103">                                        betm = beta[m];</span>
<span class="source-line-no">104</span><span id="line-104"></span>
<span class="source-line-no">105</span><span id="line-105">                                        if (VERBOSE) System.out.println("QZVEC: starting Loop B ***********************");</span>
<span class="source-line-no">106</span><span id="line-106">                                        </span>
<span class="source-line-no">107</span><span id="line-107">                                        // for i=en-1 step -1 until 1 do --</span>
<span class="source-line-no">108</span><span id="line-108">                                        LoopB: for (ii = 0; ii &lt;= na; ii++) {</span>
<span class="source-line-no">109</span><span id="line-109">                                                </span>
<span class="source-line-no">110</span><span id="line-110">                                                StateB stateB = StateB.Binit;</span>
<span class="source-line-no">111</span><span id="line-111">                                                StateLoopB: while (stateB != StateB.Bfinal) {</span>
<span class="source-line-no">112</span><span id="line-112">                                                        switch (stateB) {</span>
<span class="source-line-no">113</span><span id="line-113">                                                        case Binit :</span>
<span class="source-line-no">114</span><span id="line-114">                                                                i = en - ii - 1;</span>
<span class="source-line-no">115</span><span id="line-115">                                                                w = betm * a[i][i] - alfm * b[i][i];</span>
<span class="source-line-no">116</span><span id="line-116">                                                                r = 0.0;</span>
<span class="source-line-no">117</span><span id="line-117"></span>
<span class="source-line-no">118</span><span id="line-118">                                                                for (j = m; j &lt;= en; j++) {</span>
<span class="source-line-no">119</span><span id="line-119">                                                                        r = r +(betm * a[i][j] - alfm * b[i][j]) * b[j][en];</span>
<span class="source-line-no">120</span><span id="line-120">                                                                }       // L610</span>
<span class="source-line-no">121</span><span id="line-121"></span>
<span class="source-line-no">122</span><span id="line-122">                                                                if (i == 0 || isw == 2) {</span>
<span class="source-line-no">123</span><span id="line-123">                                                                        stateB = StateB.B630;</span>
<span class="source-line-no">124</span><span id="line-124">                                                                        break;</span>
<span class="source-line-no">125</span><span id="line-125">                                                                }</span>
<span class="source-line-no">126</span><span id="line-126">                                                                if (betm * a[i][i - 1] == 0.0) {</span>
<span class="source-line-no">127</span><span id="line-127">                                                                        stateB = StateB.B630;</span>
<span class="source-line-no">128</span><span id="line-128">                                                                        break;</span>
<span class="source-line-no">129</span><span id="line-129">                                                                }</span>
<span class="source-line-no">130</span><span id="line-130">                                                                zz = w;</span>
<span class="source-line-no">131</span><span id="line-131">                                                                s = r;</span>
<span class="source-line-no">132</span><span id="line-132">                                                                stateB = StateB.B690;</span>
<span class="source-line-no">133</span><span id="line-133">                                                                break;</span>
<span class="source-line-no">134</span><span id="line-134"></span>
<span class="source-line-no">135</span><span id="line-135">                                                        case B630 :</span>
<span class="source-line-no">136</span><span id="line-136">                                                                m = i;</span>
<span class="source-line-no">137</span><span id="line-137">                                                                if (isw == 2) {</span>
<span class="source-line-no">138</span><span id="line-138">                                                                        stateB = StateB.B640;</span>
<span class="source-line-no">139</span><span id="line-139">                                                                        break;</span>
<span class="source-line-no">140</span><span id="line-140">                                                                }</span>
<span class="source-line-no">141</span><span id="line-141">                                                                // real 1-by-1 block</span>
<span class="source-line-no">142</span><span id="line-142">                                                                t = w;</span>
<span class="source-line-no">143</span><span id="line-143">                                                                if (w == 0.0) {</span>
<span class="source-line-no">144</span><span id="line-144">                                                                        t = epsb;</span>
<span class="source-line-no">145</span><span id="line-145">                                                                }</span>
<span class="source-line-no">146</span><span id="line-146">                                                                b[i][en] = -r / t;</span>
<span class="source-line-no">147</span><span id="line-147">                                                                stateB = StateB.B700;</span>
<span class="source-line-no">148</span><span id="line-148">                                                                break;</span>
<span class="source-line-no">149</span><span id="line-149"></span>
<span class="source-line-no">150</span><span id="line-150">                                                        case B640 :</span>
<span class="source-line-no">151</span><span id="line-151">                                                                // real 2-by-2 block</span>
<span class="source-line-no">152</span><span id="line-152">                                                                x = betm * a[i][i + 1] - alfm * b[i][i + 1];</span>
<span class="source-line-no">153</span><span id="line-153">                                                                y = betm * a[i + 1][i];</span>
<span class="source-line-no">154</span><span id="line-154">                                                                q = w * zz - x * y;</span>
<span class="source-line-no">155</span><span id="line-155">                                                                t = (x * s - zz * r) / q;</span>
<span class="source-line-no">156</span><span id="line-156">                                                                b[i][en] = t;</span>
<span class="source-line-no">157</span><span id="line-157">                                                                if (Math.abs(x) &lt;= Math.abs(zz)) {</span>
<span class="source-line-no">158</span><span id="line-158">                                                                        stateB = StateB.B650;</span>
<span class="source-line-no">159</span><span id="line-159">                                                                        break;</span>
<span class="source-line-no">160</span><span id="line-160">                                                                }</span>
<span class="source-line-no">161</span><span id="line-161">                                                                b[i + 1][en] = (-r - w * t) / x;</span>
<span class="source-line-no">162</span><span id="line-162">                                                                stateB = StateB.B690;</span>
<span class="source-line-no">163</span><span id="line-163">                                                                break;</span>
<span class="source-line-no">164</span><span id="line-164"></span>
<span class="source-line-no">165</span><span id="line-165">                                                        case B650 :</span>
<span class="source-line-no">166</span><span id="line-166">                                                                b[i + 1][en] = (-s - y * t) / zz;</span>
<span class="source-line-no">167</span><span id="line-167">                                                                stateB = StateB.B690;</span>
<span class="source-line-no">168</span><span id="line-168">                                                                break;</span>
<span class="source-line-no">169</span><span id="line-169"></span>
<span class="source-line-no">170</span><span id="line-170">                                                        case B690 :</span>
<span class="source-line-no">171</span><span id="line-171">                                                                isw = 3 - isw;</span>
<span class="source-line-no">172</span><span id="line-172">                                                                stateB = StateB.B700;</span>
<span class="source-line-no">173</span><span id="line-173">                                                                break;</span>
<span class="source-line-no">174</span><span id="line-174"></span>
<span class="source-line-no">175</span><span id="line-175">                                                        case B700 :</span>
<span class="source-line-no">176</span><span id="line-176">                                                                stateB = StateB.Bfinal;</span>
<span class="source-line-no">177</span><span id="line-177">                                                                break;</span>
<span class="source-line-no">178</span><span id="line-178"></span>
<span class="source-line-no">179</span><span id="line-179">                                                        case Bfinal :</span>
<span class="source-line-no">180</span><span id="line-180">                                                                throw new RuntimeException("this should never happen!");</span>
<span class="source-line-no">181</span><span id="line-181"></span>
<span class="source-line-no">182</span><span id="line-182">                                                        }       // end switch (stateB)  </span>
<span class="source-line-no">183</span><span id="line-183">                                                }       // end StateLoopB                       </span>
<span class="source-line-no">184</span><span id="line-184">                                        }       // L700: end of LoopB</span>
<span class="source-line-no">185</span><span id="line-185">                                        if (VERBOSE) System.out.println("QZVEC: finished Loop B ***********************");</span>
<span class="source-line-no">186</span><span id="line-186">                                        // end real vector</span>
<span class="source-line-no">187</span><span id="line-187">                                        stateA = StateA.A800;</span>
<span class="source-line-no">188</span><span id="line-188">                                        break;</span>
<span class="source-line-no">189</span><span id="line-189"></span>
<span class="source-line-no">190</span><span id="line-190">                                case A710:</span>
<span class="source-line-no">191</span><span id="line-191">                                        // complex vector</span>
<span class="source-line-no">192</span><span id="line-192">                                        m = na;</span>
<span class="source-line-no">193</span><span id="line-193">                                        almr = alfr[m];</span>
<span class="source-line-no">194</span><span id="line-194">                                        almi = alfi[m];</span>
<span class="source-line-no">195</span><span id="line-195">                                        betm = beta[m];</span>
<span class="source-line-no">196</span><span id="line-196">                                        // last vector component chosen imaginary so that eigenvector matrix is triangular</span>
<span class="source-line-no">197</span><span id="line-197">                                        y = betm * a[en][na];</span>
<span class="source-line-no">198</span><span id="line-198">                                        b[na][na] = -almi * b[en][en] / y;</span>
<span class="source-line-no">199</span><span id="line-199">                                        b[na][en] = (almr * b[en][en] - betm * a[en][en]) / y;</span>
<span class="source-line-no">200</span><span id="line-200">                                        b[en][na] = 0.0;</span>
<span class="source-line-no">201</span><span id="line-201">                                        b[en][en] = 1.0;</span>
<span class="source-line-no">202</span><span id="line-202">                                        enm2 = na;                      // TODO: check!</span>
<span class="source-line-no">203</span><span id="line-203">                                        if (enm2 == 0) {</span>
<span class="source-line-no">204</span><span id="line-204">                                                stateA = StateA.A795;</span>
<span class="source-line-no">205</span><span id="line-205">                                                break;</span>
<span class="source-line-no">206</span><span id="line-206">                                        }</span>
<span class="source-line-no">207</span><span id="line-207"></span>
<span class="source-line-no">208</span><span id="line-208">                                        if (VERBOSE) System.out.println("QZVEC: starting Loop C, enm2 = " + enm2);</span>
<span class="source-line-no">209</span><span id="line-209">                                        LoopC: for (ii = 0; ii &lt; enm2; ii++) {</span>
<span class="source-line-no">210</span><span id="line-210">                                                if (VERBOSE) System.out.println("    ii = " + ii);</span>
<span class="source-line-no">211</span><span id="line-211">                                                StateC stateC = StateC.Cinit;</span>
<span class="source-line-no">212</span><span id="line-212">                                                StateLoopC: while (stateC != StateC.Cfinal) {</span>
<span class="source-line-no">213</span><span id="line-213">                                                        if (VERBOSE) System.out.println("       StateLoopC: " + stateC);</span>
<span class="source-line-no">214</span><span id="line-214">                                                        switch (stateC) {</span>
<span class="source-line-no">215</span><span id="line-215">                                                        </span>
<span class="source-line-no">216</span><span id="line-216">                                                        case Cinit :</span>
<span class="source-line-no">217</span><span id="line-217">                                                                i = na - ii - 1;</span>
<span class="source-line-no">218</span><span id="line-218">                                                                w = betm * a[i][i] - almr * b[i][i];</span>
<span class="source-line-no">219</span><span id="line-219">                                                                w1 = -almi * b[i][i];</span>
<span class="source-line-no">220</span><span id="line-220">                                                                ra = 0.0;</span>
<span class="source-line-no">221</span><span id="line-221">                                                                sa = 0.0;</span>
<span class="source-line-no">222</span><span id="line-222"></span>
<span class="source-line-no">223</span><span id="line-223">                                                                for (j = m; j &lt;= en; j++)</span>
<span class="source-line-no">224</span><span id="line-224">                                                                {</span>
<span class="source-line-no">225</span><span id="line-225">                                                                        x = betm * a[i][j] - almr * b[i][j];</span>
<span class="source-line-no">226</span><span id="line-226">                                                                        x1 = -almi * b[i][j];</span>
<span class="source-line-no">227</span><span id="line-227">                                                                        ra = ra + x * b[j][na] - x1 * b[j][en];</span>
<span class="source-line-no">228</span><span id="line-228">                                                                        sa = sa + x * b[j][en] + x1 * b[j][na];</span>
<span class="source-line-no">229</span><span id="line-229">                                                                }       // L760</span>
<span class="source-line-no">230</span><span id="line-230"></span>
<span class="source-line-no">231</span><span id="line-231">                                                                if (i == 0 || isw == 2) {</span>
<span class="source-line-no">232</span><span id="line-232">                                                                        stateC = StateC.C770;</span>
<span class="source-line-no">233</span><span id="line-233">                                                                        break;</span>
<span class="source-line-no">234</span><span id="line-234">                                                                }</span>
<span class="source-line-no">235</span><span id="line-235">                                                                if (betm * a[i][i - 1] == 0.0) {</span>
<span class="source-line-no">236</span><span id="line-236">                                                                        stateC = StateC.C770;</span>
<span class="source-line-no">237</span><span id="line-237">                                                                        break;</span>
<span class="source-line-no">238</span><span id="line-238">                                                                }</span>
<span class="source-line-no">239</span><span id="line-239">                                                                zz = w;</span>
<span class="source-line-no">240</span><span id="line-240">                                                                z1 = w1;</span>
<span class="source-line-no">241</span><span id="line-241">                                                                r = ra;</span>
<span class="source-line-no">242</span><span id="line-242">                                                                s = sa;</span>
<span class="source-line-no">243</span><span id="line-243">                                                                isw = 2;</span>
<span class="source-line-no">244</span><span id="line-244">                                                                stateC = StateC.C790;</span>
<span class="source-line-no">245</span><span id="line-245">                                                                break;</span>
<span class="source-line-no">246</span><span id="line-246"></span>
<span class="source-line-no">247</span><span id="line-247">                                                        case C770 :</span>
<span class="source-line-no">248</span><span id="line-248">                                                                m = i;</span>
<span class="source-line-no">249</span><span id="line-249">                                                                if (isw == 2) {</span>
<span class="source-line-no">250</span><span id="line-250">                                                                        stateC = StateC.C780;</span>
<span class="source-line-no">251</span><span id="line-251">                                                                        break;</span>
<span class="source-line-no">252</span><span id="line-252">                                                                }</span>
<span class="source-line-no">253</span><span id="line-253">                                                                // complex 1-by-1 block </span>
<span class="source-line-no">254</span><span id="line-254">                                                                tr = -ra;</span>
<span class="source-line-no">255</span><span id="line-255">                                                                ti = -sa;</span>
<span class="source-line-no">256</span><span id="line-256">                                                                stateC = StateC.C773;</span>
<span class="source-line-no">257</span><span id="line-257">                                                                break;</span>
<span class="source-line-no">258</span><span id="line-258"></span>
<span class="source-line-no">259</span><span id="line-259">                                                        case C773:</span>
<span class="source-line-no">260</span><span id="line-260">                                                                dr = w;</span>
<span class="source-line-no">261</span><span id="line-261">                                                                di = w1;</span>
<span class="source-line-no">262</span><span id="line-262">                                                                stateC = StateC.C775;</span>
<span class="source-line-no">263</span><span id="line-263">                                                                break;</span>
<span class="source-line-no">264</span><span id="line-264"></span>
<span class="source-line-no">265</span><span id="line-265">                                                        case C775:</span>
<span class="source-line-no">266</span><span id="line-266">                                                                // complex divide (t1,t2) = (tr,ti) / (dr,di)</span>
<span class="source-line-no">267</span><span id="line-267">                                                                if (Math.abs(di) &gt; Math.abs(dr)) {</span>
<span class="source-line-no">268</span><span id="line-268">                                                                        stateC = StateC.C777;</span>
<span class="source-line-no">269</span><span id="line-269">                                                                        break;</span>
<span class="source-line-no">270</span><span id="line-270">                                                                }                                                       </span>
<span class="source-line-no">271</span><span id="line-271">                                                                rr = di / dr;</span>
<span class="source-line-no">272</span><span id="line-272">                                                                d = dr + di * rr;</span>
<span class="source-line-no">273</span><span id="line-273">                                                                t1 = (tr + ti * rr) / d;</span>
<span class="source-line-no">274</span><span id="line-274">                                                                t2 = (ti - tr * rr) / d;</span>
<span class="source-line-no">275</span><span id="line-275"></span>
<span class="source-line-no">276</span><span id="line-276">                                                                switch (isw) {  // go to (787,782), isw</span>
<span class="source-line-no">277</span><span id="line-277">                                                                case 1: </span>
<span class="source-line-no">278</span><span id="line-278">                                                                        stateC = StateC.C787;</span>
<span class="source-line-no">279</span><span id="line-279">                                                                        continue StateLoopC;</span>
<span class="source-line-no">280</span><span id="line-280">                                                                        //break;</span>
<span class="source-line-no">281</span><span id="line-281">                                                                case 2:</span>
<span class="source-line-no">282</span><span id="line-282">                                                                        stateC = StateC.C782;</span>
<span class="source-line-no">283</span><span id="line-283">                                                                        continue StateLoopC;</span>
<span class="source-line-no">284</span><span id="line-284">                                                                        //break;</span>
<span class="source-line-no">285</span><span id="line-285">                                                                default: </span>
<span class="source-line-no">286</span><span id="line-286">                                                                        throw new RuntimeException("illegal state isw = " + isw);</span>
<span class="source-line-no">287</span><span id="line-287">                                                                }</span>
<span class="source-line-no">288</span><span id="line-288">                                                                //stateC = StateC.C777;</span>
<span class="source-line-no">289</span><span id="line-289">                                                                //break;</span>
<span class="source-line-no">290</span><span id="line-290"></span>
<span class="source-line-no">291</span><span id="line-291">                                                        case C777:</span>
<span class="source-line-no">292</span><span id="line-292">                                                                rr = dr / di;</span>
<span class="source-line-no">293</span><span id="line-293">                                                                d = dr * rr + di;</span>
<span class="source-line-no">294</span><span id="line-294">                                                                t1 = (tr * rr + ti) / d;</span>
<span class="source-line-no">295</span><span id="line-295">                                                                t2 = (ti * rr - tr) / d;</span>
<span class="source-line-no">296</span><span id="line-296">                                                                switch (isw) {  // go to (787,782), isw</span>
<span class="source-line-no">297</span><span id="line-297">                                                                case 1: </span>
<span class="source-line-no">298</span><span id="line-298">                                                                        stateC = StateC.C787;</span>
<span class="source-line-no">299</span><span id="line-299">                                                                        continue StateLoopC;</span>
<span class="source-line-no">300</span><span id="line-300">                                                                        //break;</span>
<span class="source-line-no">301</span><span id="line-301">                                                                case 2: </span>
<span class="source-line-no">302</span><span id="line-302">                                                                        stateC = StateC.C782;</span>
<span class="source-line-no">303</span><span id="line-303">                                                                        continue StateLoopC;</span>
<span class="source-line-no">304</span><span id="line-304">                                                                        //break;</span>
<span class="source-line-no">305</span><span id="line-305">                                                                default: </span>
<span class="source-line-no">306</span><span id="line-306">                                                                        throw new RuntimeException("illegal state isw = " + isw);</span>
<span class="source-line-no">307</span><span id="line-307">                                                                }</span>
<span class="source-line-no">308</span><span id="line-308">                                                                //stateC = StateC.C780;</span>
<span class="source-line-no">309</span><span id="line-309">                                                                //break;</span>
<span class="source-line-no">310</span><span id="line-310"></span>
<span class="source-line-no">311</span><span id="line-311">                                                        case C780:</span>
<span class="source-line-no">312</span><span id="line-312">                                                                // complex 2-by-2 block </span>
<span class="source-line-no">313</span><span id="line-313">                                                                x = betm * a[i][i + 1] - almr * b[i][i + 1];</span>
<span class="source-line-no">314</span><span id="line-314">                                                                x1 = -almi * b[i][i + 1];</span>
<span class="source-line-no">315</span><span id="line-315">                                                                y = betm * a[i + 1][i];</span>
<span class="source-line-no">316</span><span id="line-316">                                                                tr = y * ra - w * r + w1 * s;</span>
<span class="source-line-no">317</span><span id="line-317">                                                                ti = y * sa - w * s - w1 * r;</span>
<span class="source-line-no">318</span><span id="line-318">                                                                dr = w * zz - w1 * z1 - x * y;</span>
<span class="source-line-no">319</span><span id="line-319">                                                                di = w * z1 + w1 * zz - x1 * y;</span>
<span class="source-line-no">320</span><span id="line-320">                                                                if (dr == 0.0 &amp;&amp; di == 0.0) {</span>
<span class="source-line-no">321</span><span id="line-321">                                                                        dr = epsb;</span>
<span class="source-line-no">322</span><span id="line-322">                                                                }</span>
<span class="source-line-no">323</span><span id="line-323">                                                                stateC = StateC.C775;</span>
<span class="source-line-no">324</span><span id="line-324">                                                                break;</span>
<span class="source-line-no">325</span><span id="line-325"></span>
<span class="source-line-no">326</span><span id="line-326">                                                        case C782:</span>
<span class="source-line-no">327</span><span id="line-327">                                                                b[i + 1][na] = t1;</span>
<span class="source-line-no">328</span><span id="line-328">                                                                b[i + 1][en] = t2;</span>
<span class="source-line-no">329</span><span id="line-329">                                                                isw = 1;</span>
<span class="source-line-no">330</span><span id="line-330">                                                                if (Math.abs(y) &gt; Math.abs(w) + Math.abs(w1)) {</span>
<span class="source-line-no">331</span><span id="line-331">                                                                        stateC = StateC.C785;</span>
<span class="source-line-no">332</span><span id="line-332">                                                                        break;</span>
<span class="source-line-no">333</span><span id="line-333">                                                                }</span>
<span class="source-line-no">334</span><span id="line-334">                                                                tr = -ra - x * b[(i + 1)][na] + x1 * b[(i + 1)][en];</span>
<span class="source-line-no">335</span><span id="line-335">                                                                ti = -sa - x * b[(i + 1)][en] - x1 * b[(i + 1)][na];</span>
<span class="source-line-no">336</span><span id="line-336">                                                                stateC = StateC.C773;</span>
<span class="source-line-no">337</span><span id="line-337">                                                                break;</span>
<span class="source-line-no">338</span><span id="line-338"></span>
<span class="source-line-no">339</span><span id="line-339">                                                        case C785:</span>
<span class="source-line-no">340</span><span id="line-340">                                                                t1 = (-r - zz * b[(i + 1)][na] + z1 * b[(i + 1)][en]) / y;</span>
<span class="source-line-no">341</span><span id="line-341">                                                                t2 = (-s - zz * b[(i + 1)][en] - z1 * b[(i + 1)][na]) / y;</span>
<span class="source-line-no">342</span><span id="line-342">                                                                stateC = StateC.C787;</span>
<span class="source-line-no">343</span><span id="line-343">                                                                break;</span>
<span class="source-line-no">344</span><span id="line-344"></span>
<span class="source-line-no">345</span><span id="line-345">                                                        case C787:</span>
<span class="source-line-no">346</span><span id="line-346">                                                                b[i][na] = t1;</span>
<span class="source-line-no">347</span><span id="line-347">                                                                b[i][en] = t2;</span>
<span class="source-line-no">348</span><span id="line-348">                                                                stateC = StateC.C790;</span>
<span class="source-line-no">349</span><span id="line-349">                                                                break;</span>
<span class="source-line-no">350</span><span id="line-350"></span>
<span class="source-line-no">351</span><span id="line-351">                                                        case C790:</span>
<span class="source-line-no">352</span><span id="line-352">                                                                stateC = StateC.Cfinal;</span>
<span class="source-line-no">353</span><span id="line-353">                                                                break;</span>
<span class="source-line-no">354</span><span id="line-354"></span>
<span class="source-line-no">355</span><span id="line-355">                                                        case Cfinal:</span>
<span class="source-line-no">356</span><span id="line-356">                                                                throw new RuntimeException("this should never happen!");</span>
<span class="source-line-no">357</span><span id="line-357"></span>
<span class="source-line-no">358</span><span id="line-358">                                                        }       // end switch(stateC)</span>
<span class="source-line-no">359</span><span id="line-359">                                                }       // end StateLoopC</span>
<span class="source-line-no">360</span><span id="line-360"></span>
<span class="source-line-no">361</span><span id="line-361">                                        }       // L790: end of LoopC:</span>
<span class="source-line-no">362</span><span id="line-362"></span>
<span class="source-line-no">363</span><span id="line-363">                                        if (VERBOSE) System.out.println("QZVEC: finished Loop C ***********************");</span>
<span class="source-line-no">364</span><span id="line-364">                                        stateA = StateA.A795;</span>
<span class="source-line-no">365</span><span id="line-365">                                        break;</span>
<span class="source-line-no">366</span><span id="line-366">                                        // end complex vector</span>
<span class="source-line-no">367</span><span id="line-367"></span>
<span class="source-line-no">368</span><span id="line-368">                                case A795:</span>
<span class="source-line-no">369</span><span id="line-369">                                        isw = 3 - isw;</span>
<span class="source-line-no">370</span><span id="line-370">                                        stateA = StateA.A800;</span>
<span class="source-line-no">371</span><span id="line-371">                                        break;</span>
<span class="source-line-no">372</span><span id="line-372"></span>
<span class="source-line-no">373</span><span id="line-373">                                case A800:</span>
<span class="source-line-no">374</span><span id="line-374">                                        stateA = StateA.Afinal;</span>
<span class="source-line-no">375</span><span id="line-375">                                        break;</span>
<span class="source-line-no">376</span><span id="line-376">                                        </span>
<span class="source-line-no">377</span><span id="line-377">                                case Afinal:</span>
<span class="source-line-no">378</span><span id="line-378">                                        throw new RuntimeException("this should never happen!");</span>
<span class="source-line-no">379</span><span id="line-379">                                }       // end switch(stateA)</span>
<span class="source-line-no">380</span><span id="line-380"></span>
<span class="source-line-no">381</span><span id="line-381">                        }       // end StateLoopA </span>
<span class="source-line-no">382</span><span id="line-382">                }       // L800: end LoopA</span>
<span class="source-line-no">383</span><span id="line-383">                if (VERBOSE) System.out.println("QZVEC: finished Loop A ***********************");</span>
<span class="source-line-no">384</span><span id="line-384"></span>
<span class="source-line-no">385</span><span id="line-385">                // end back substitution. transform to original coordinate system.</span>
<span class="source-line-no">386</span><span id="line-386">                for (jj = 0; jj &lt; n; jj++) {</span>
<span class="source-line-no">387</span><span id="line-387">                        j = n - jj - 1;</span>
<span class="source-line-no">388</span><span id="line-388"></span>
<span class="source-line-no">389</span><span id="line-389">                        for (i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">390</span><span id="line-390">                                zz = 0.0;</span>
<span class="source-line-no">391</span><span id="line-391">                                for (k = 0; k &lt;= j; k++) {</span>
<span class="source-line-no">392</span><span id="line-392">                                        zz = zz + z[i][k] * b[k][j];</span>
<span class="source-line-no">393</span><span id="line-393">                                }       // L860</span>
<span class="source-line-no">394</span><span id="line-394">                                z[i][j] = zz;</span>
<span class="source-line-no">395</span><span id="line-395">                        }</span>
<span class="source-line-no">396</span><span id="line-396">                }       // L880: end for (jj ...</span>
<span class="source-line-no">397</span><span id="line-397"></span>
<span class="source-line-no">398</span><span id="line-398">                if (VERBOSE) System.out.println("QZVEC: starting Loop D ***********************");</span>
<span class="source-line-no">399</span><span id="line-399">                // normalize so that modulus of largest component of each vector is 1.</span>
<span class="source-line-no">400</span><span id="line-400">                // (isw is 1 initially from before)</span>
<span class="source-line-no">401</span><span id="line-401">                LoopD: for (j = 0; j &lt; n; j++) {</span>
<span class="source-line-no">402</span><span id="line-402">                        </span>
<span class="source-line-no">403</span><span id="line-403">                        StateD stateD = StateD.Dinit;</span>
<span class="source-line-no">404</span><span id="line-404">                        StateLoopD: while (stateD != StateD.Dfinal) {</span>
<span class="source-line-no">405</span><span id="line-405"></span>
<span class="source-line-no">406</span><span id="line-406">                                switch (stateD) {</span>
<span class="source-line-no">407</span><span id="line-407">                                case Dinit :</span>
<span class="source-line-no">408</span><span id="line-408">                                        d = 0.0;</span>
<span class="source-line-no">409</span><span id="line-409">                                        if (isw == 2) {</span>
<span class="source-line-no">410</span><span id="line-410">                                                stateD = StateD.D920;</span>
<span class="source-line-no">411</span><span id="line-411">                                                break;</span>
<span class="source-line-no">412</span><span id="line-412">                                        }</span>
<span class="source-line-no">413</span><span id="line-413">                                        if (alfi[j] != 0.0) {</span>
<span class="source-line-no">414</span><span id="line-414">                                                stateD = StateD.D945;</span>
<span class="source-line-no">415</span><span id="line-415">                                                break;</span>
<span class="source-line-no">416</span><span id="line-416">                                        }</span>
<span class="source-line-no">417</span><span id="line-417"></span>
<span class="source-line-no">418</span><span id="line-418">                                        for (i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">419</span><span id="line-419">                                                //      if ((Math.abs(z[i][j])) &gt; d) d = (Math.abs(z[i][j]));</span>
<span class="source-line-no">420</span><span id="line-420">                                                d = Math.max(d, Math.abs(z[i][j]));</span>
<span class="source-line-no">421</span><span id="line-421">                                        } // L890</span>
<span class="source-line-no">422</span><span id="line-422"></span>
<span class="source-line-no">423</span><span id="line-423">                                        for (i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">424</span><span id="line-424">                                                z[i][j] = z[i][j] / d;</span>
<span class="source-line-no">425</span><span id="line-425">                                        }       // L900</span>
<span class="source-line-no">426</span><span id="line-426"></span>
<span class="source-line-no">427</span><span id="line-427">                                        stateD = StateD.D950;</span>
<span class="source-line-no">428</span><span id="line-428">                                        break;</span>
<span class="source-line-no">429</span><span id="line-429"></span>
<span class="source-line-no">430</span><span id="line-430">                                case D920:</span>
<span class="source-line-no">431</span><span id="line-431">                                        for (i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">432</span><span id="line-432">                                                r = Math.abs(z[i][j - 1]) + Math.abs(z[i][j]);</span>
<span class="source-line-no">433</span><span id="line-433">                                                if (r != 0.0) {</span>
<span class="source-line-no">434</span><span id="line-434">                                                        // r = r * dsqrt((z(i,j-1)/r)**2 + (z(i,j)/r)**2)</span>
<span class="source-line-no">435</span><span id="line-435">                                                        r = r * Math.hypot(z[i][j - 1] / r, z[i][j] / r);</span>
<span class="source-line-no">436</span><span id="line-436">                                                }</span>
<span class="source-line-no">437</span><span id="line-437">                                                if (r &gt; d) {</span>
<span class="source-line-no">438</span><span id="line-438">                                                        d = r;</span>
<span class="source-line-no">439</span><span id="line-439">                                                }</span>
<span class="source-line-no">440</span><span id="line-440">                                        }       // L930</span>
<span class="source-line-no">441</span><span id="line-441"></span>
<span class="source-line-no">442</span><span id="line-442">                                        for (i = 0; i &lt; n; i++) {</span>
<span class="source-line-no">443</span><span id="line-443">                                                z[i][j - 1] = z[i][j - 1] / d;</span>
<span class="source-line-no">444</span><span id="line-444">                                                z[i][j] = z[i][j] / d;</span>
<span class="source-line-no">445</span><span id="line-445">                                        }       // L940</span>
<span class="source-line-no">446</span><span id="line-446"></span>
<span class="source-line-no">447</span><span id="line-447">                                        stateD = StateD.D945;</span>
<span class="source-line-no">448</span><span id="line-448">                                        break;</span>
<span class="source-line-no">449</span><span id="line-449"></span>
<span class="source-line-no">450</span><span id="line-450">                                case D945:</span>
<span class="source-line-no">451</span><span id="line-451">                                        isw = 3 - isw;</span>
<span class="source-line-no">452</span><span id="line-452">                                        stateD = StateD.D950;</span>
<span class="source-line-no">453</span><span id="line-453">                                        break;</span>
<span class="source-line-no">454</span><span id="line-454"></span>
<span class="source-line-no">455</span><span id="line-455">                                case D950:</span>
<span class="source-line-no">456</span><span id="line-456">                                        stateD = StateD.Dfinal;</span>
<span class="source-line-no">457</span><span id="line-457">                                        break;</span>
<span class="source-line-no">458</span><span id="line-458"></span>
<span class="source-line-no">459</span><span id="line-459">                                case Dfinal:</span>
<span class="source-line-no">460</span><span id="line-460">                                        throw new RuntimeException("this should never happen!");</span>
<span class="source-line-no">461</span><span id="line-461"></span>
<span class="source-line-no">462</span><span id="line-462">                                }       // end switch(stateD)</span>
<span class="source-line-no">463</span><span id="line-463">                        }       // end StateLoopD</span>
<span class="source-line-no">464</span><span id="line-464"></span>
<span class="source-line-no">465</span><span id="line-465">                }       // L950: end LoopD</span>
<span class="source-line-no">466</span><span id="line-466">                if (VERBOSE) System.out.println("QZVEC: finished Loop D ***********************");</span>
<span class="source-line-no">467</span><span id="line-467"></span>
<span class="source-line-no">468</span><span id="line-468">        }       // end of qzvec()</span>
<span class="source-line-no">469</span><span id="line-469"></span>
<span class="source-line-no">470</span><span id="line-470"></span>
<span class="source-line-no">471</span><span id="line-471">        private enum StateA {</span>
<span class="source-line-no">472</span><span id="line-472">                Ainit, Afinal, A795, A710, A800</span>
<span class="source-line-no">473</span><span id="line-473">        }</span>
<span class="source-line-no">474</span><span id="line-474"></span>
<span class="source-line-no">475</span><span id="line-475">        private enum StateB {</span>
<span class="source-line-no">476</span><span id="line-476">                Binit, Bfinal, B630, B690, B640, B700, B650</span>
<span class="source-line-no">477</span><span id="line-477">        }</span>
<span class="source-line-no">478</span><span id="line-478"></span>
<span class="source-line-no">479</span><span id="line-479">        private enum StateC {</span>
<span class="source-line-no">480</span><span id="line-480">                Cinit, Cfinal, C770, C790, C780, C773, C775, C777, C787, C782, C785</span>
<span class="source-line-no">481</span><span id="line-481">        }</span>
<span class="source-line-no">482</span><span id="line-482"></span>
<span class="source-line-no">483</span><span id="line-483">        private enum StateD {</span>
<span class="source-line-no">484</span><span id="line-484">                Dinit, Dfinal, D920, D945, D950</span>
<span class="source-line-no">485</span><span id="line-485">        }</span>
<span class="source-line-no">486</span><span id="line-486"></span>
<span class="source-line-no">487</span><span id="line-487">}</span>




























































</pre>
</div>
</main>
</body>
</html>
